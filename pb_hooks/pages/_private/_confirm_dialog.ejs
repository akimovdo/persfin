<!-- Global Confirmation Dialog Component -->
<dialog id="confirmDialog" class="modal">
  <div class="modal-box max-w-md">
    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" id="confirmDialogIcon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span id="confirmDialogTitle">Подтверждение</span>
    </h3>
    <p id="confirmDialogMessage" class="py-2 text-base leading-relaxed"></p>
    <div id="confirmDialogDetails" class="py-2 text-sm opacity-80 hidden"></div>
    <div class="modal-action">
      <button id="confirmDialogCancel" class="btn btn-ghost">Отмена</button>
      <button id="confirmDialogConfirm" class="btn btn-primary">Подтвердить</button>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button id="confirmDialogBackdrop">close</button>
  </form>
</dialog>

<script>
(function() {
  'use strict';

  var confirmDialog = document.getElementById('confirmDialog');
  if (!confirmDialog) return;

  var confirmDialogTitle = document.getElementById('confirmDialogTitle');
  var confirmDialogMessage = document.getElementById('confirmDialogMessage');
  var confirmDialogDetails = document.getElementById('confirmDialogDetails');
  var confirmDialogIcon = document.getElementById('confirmDialogIcon');
  var confirmDialogConfirm = document.getElementById('confirmDialogConfirm');
  var confirmDialogCancel = document.getElementById('confirmDialogCancel');
  var confirmDialogBackdrop = document.getElementById('confirmDialogBackdrop');

  var currentResolve = null;
  var icons = {
    question: 'M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
    warning: 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z',
    danger: 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z',
    info: 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'
  };

  function resetDialog() {
    currentResolve = null;
    confirmDialogDetails.classList.add('hidden');
    confirmDialogDetails.innerHTML = '';
    confirmDialogIcon.classList.remove('text-warning', 'text-error', 'text-info', 'text-primary');
  }

  window.showConfirmDialog = function(options) {
    options = options || {};

    return new Promise(function(resolve) {
      if (!confirmDialog.showModal) {
        resolve(window.confirm(options.message || 'Вы уверены?'));
        return;
      }

      currentResolve = resolve;

      confirmDialogTitle.textContent = options.title || 'Подтверждение';
      confirmDialogMessage.textContent = options.message || 'Вы уверены?';

      if (options.details) {
        confirmDialogDetails.textContent = options.details;
        confirmDialogDetails.classList.remove('hidden');
      } else {
        confirmDialogDetails.classList.add('hidden');
        confirmDialogDetails.innerHTML = '';
      }

      var iconType = options.type || 'question';
      var iconPath = icons[iconType] || icons.question;
      confirmDialogIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="' + iconPath + '" />';

      confirmDialogIcon.classList.remove('text-warning', 'text-error', 'text-info', 'text-primary');
      if (iconType === 'warning') {
        confirmDialogIcon.classList.add('text-warning');
      } else if (iconType === 'danger') {
        confirmDialogIcon.classList.add('text-error');
      } else if (iconType === 'info') {
        confirmDialogIcon.classList.add('text-info');
      } else {
        confirmDialogIcon.classList.add('text-primary');
      }

      confirmDialogConfirm.textContent = options.confirmText || 'Подтвердить';
      confirmDialogCancel.textContent = options.cancelText || 'Отмена';
      confirmDialogConfirm.className = 'btn ' + (options.confirmClass || 'btn-primary');

      confirmDialog.showModal();
    });
  };

  confirmDialogConfirm.addEventListener('click', function() {
    confirmDialog.close();
    if (currentResolve) {
      currentResolve(true);
      resetDialog();
    }
  });

  confirmDialogCancel.addEventListener('click', function() {
    confirmDialog.close();
    if (currentResolve) {
      currentResolve(false);
      resetDialog();
    }
  });

  confirmDialogBackdrop.addEventListener('click', function() {
    if (currentResolve) {
      currentResolve(false);
      resetDialog();
    }
  });

  confirmDialog.addEventListener('close', function() {
    if (currentResolve) {
      currentResolve(false);
      resetDialog();
    }
  });
})();
</script>
