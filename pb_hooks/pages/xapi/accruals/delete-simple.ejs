<%
meta('layout', false);

if (request.method !== 'DELETE') {
    return response.json(405, {
        success: false,
        message: 'Используйте метод DELETE'
    });
}

try {
    // Получаем параметры из URL
    const query = url(request.url).query || {};
    const recordId = query.id;
    
    if (!recordId) {
        return response.json(400, {
            success: false,
            message: 'ID записи не указан'
        });
    }
    
    // Получаем и удаляем запись
    const record = $app.findRecordById('accruals', recordId);
    $app.delete(record);

    return response.json(200, {
        success: true,
        message: 'Начисление успешно удалено'
    });

} catch (error) {
    return response.json(500, {
        success: false,
        message: 'Ошибка при удалении: ' + error.message
    });
}
%>
