<%
/**
 * GET /xapi/tochka/payments-test
 * Получение нескольких последних транзакций для проверки
 */

if (request.method !== 'GET') {
  return response.json(405, { 
    success: false,
    error: 'Method Not Allowed'
  });
}

try {
  const payments = $app.findRecordsByFilter(
    'payments',
    '',
    '-created',
    5,
    0
  );

  const result = [];
  for (let i = 0; i < payments.length; i++) {
    const p = payments[i];
    result.push({
      id: p.id,
      transactionId: p.getString('transactionId'),
      sum: p.getFloat('sum'),
      date: p.getString('date'),
      description: p.getString('description'),
      creditDebitIndicator: p.getString('creditDebitIndicator'),
      last_sync_date: p.getString('last_sync_date'),
      created: p.getString('created')
    });
  }

  return response.json(200, {
    success: true,
    total: result.length,
    data: result
  });
} catch (error) {
  return response.json(500, {
    success: false,
    error: error.message || String(error)
  });
}
%>
